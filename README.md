# 「聚时」焦虑缓解与任务规划 Agent - MVP

🎯 专为大学生设计的情绪-任务双驱动智能助手

## 🌟 MVP 功能特性

### ✅ 已实现核心功能

- **智能情绪分析**: 基于硅基流动AI分析用户文本情绪，1-10分评分系统
- **情绪驱动对话**: 根据情绪评分调整AI回复策略和语气
- **智能任务拆解**: 
  - 重度焦虑(1-3分): 原子级任务拆解，5分钟内可完成
  - 中度焦虑(4-6分): 流程化拆解，25分钟番茄钟时长
  - 状态良好(7-10分): 目标导向拆解，灵活时间安排
- **现代化聊天界面**: 
  - 🎨 全新UI设计，支持深色/浅色主题切换
  - 📝 完整Markdown渲染支持（标题、列表、表格、引用等）
  - 💻 代码高亮显示，支持多种编程语言
  - 📋 一键代码复制功能
  - 🚀 流畅动画效果和用户体验优化
- **响应式设计**: 现代化UI，完美支持移动端和桌面端

### 🚧 规划中功能

- 番茄钟专注计时
- 任务进度管理
- 情绪趋势分析
- 成长笔记记录
- 第三方工具集成

## 🚀 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置环境变量

创建 `.env.local` 文件：

```env
# AI API 配置 (必需)
SILICONFLOW_API_KEY=你的硅基流动API密钥

# Next.js 配置
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key
NODE_ENV=development
```

#### 获取硅基流动API密钥：
1. 访问 [硅基流动官网](https://cloud.siliconflow.cn/)
2. 注册登录账户
3. 进入 "API 管理" 页面
4. 创建新的API密钥并复制到环境变量中

### 3. 测试API连接

运行测试脚本验证API配置：

```bash
node test-api.js
```

成功输出示例：
```
✅ 你的 API 密钥配置正确，可以正常工作！
```

### 4. 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:3000 开始体验

### 4. 运行测试

```bash
npm test
```

## 📖 使用指南

### 💬 聊天界面功能

聚时助手现在支持富文本对话，包括：

- **Markdown格式**: 支持标题、粗体、斜体、列表、表格等
- **代码显示**: 语法高亮和一键复制功能
- **主题切换**: 浅色/深色/系统主题
- **智能情绪识别**: 实时显示情绪评分和状态
- **流畅动画**: 现代化的交互体验

### 情绪评分系统

| 评分区间 | 状态描述 | AI策略 | 任务拆解特点 |
|----------|----------|--------|-------------|
| 1-3分 | 重度焦虑 | 极度温和支持 | 原子级步骤，5分钟内完成 |
| 4-6分 | 中度焦虑 | 理解引导 | 流程化拆解，明确时间预估 |
| 7-10分 | 状态良好 | 积极协作 | 目标导向，框架性指导 |

### 对话示例

**重度焦虑场景** (评分: 2分)
- 用户: "我完全不知道这个作业怎么写，感觉太难了"
- AI: "我理解你现在的感受，让我们把这个任务分解成非常小的、容易完成的步骤..."

**中度焦虑场景** (评分: 5分)  
- 用户: "我有点担心明天的考试"
- AI: "我能感受到你的担忧，让我帮你把复习计划理清楚，制定一个清晰的安排..."

**状态良好场景** (评分: 8分)
- 用户: "我想制定一个学习计划"
- AI: "很好！我能感受到你的积极状态，让我们一起制定一个高效的执行方案..."

## 🏗️ 技术架构

### 前端技术栈
- **Next.js 14**: React全栈框架
- **TypeScript**: 类型安全
- **Tailwind CSS**: 现代化样式
- **shadcn/ui**: 高质量组件库
- **react-markdown**: Markdown渲染支持
- **react-syntax-highlighter**: 代码高亮
- **next-themes**: 主题切换支持

### 后端技术栈  
- **Next.js API Routes**: 服务端API
- **硅基流动API**: AI模型服务
- **TypeScript**: 端到端类型安全

### 测试框架
- **Jest**: 单元测试
- **React Testing Library**: 组件测试
- **TDD开发**: 测试驱动开发

## 📁 项目结构

```
src/
├── app/                    # Next.js App Router页面
│   ├── api/chat/          # AI对话API
│   ├── chat/              # 聊天页面
│   └── dashboard/         # 工作台页面
├── components/
│   ├── ui/                # 基础UI组件
│   └── chat/              # 对话相关组件
├── lib/
│   ├── ai/                # AI功能模块
│   │   └── emotion-analyzer.ts  # 情绪分析器
│   └── task/              # 任务管理模块
│       └── decomposer.ts  # 任务拆解器
└── types/                 # TypeScript类型定义
```

## 🧪 测试覆盖

- ✅ 情绪分析器 (EmotionAnalyzer)
- ✅ 任务拆解器 (TaskDecomposer)  
- ✅ 情绪评分输入组件
- ✅ 聊天界面组件
- ✅ API错误处理
- ✅ 边界条件测试

## 🔧 开发说明

### TDD开发流程

本项目采用测试驱动开发(TDD)：

1. **编写测试** - 定义预期行为
2. **运行测试** - 确认测试失败
3. **实现功能** - 编写最小可行代码
4. **测试通过** - 验证功能正确
5. **重构优化** - 改进代码质量

### 代码风格

- 使用TypeScript确保类型安全
- 组件采用函数式编程
- 遵循React Hooks最佳实践
- 统一的错误处理机制

## 🎨 设计原则

### 用户体验
- **情绪优先**: 基于用户情绪状态调整交互
- **渐进式引导**: 从简单到复杂的任务拆解
- **即时反馈**: 实时显示情绪评分和建议

### 技术原则
- **类型安全**: 全面的TypeScript覆盖
- **测试驱动**: 确保代码质量和可靠性
- **模块化**: 清晰的功能模块划分
- **可扩展**: 为后续功能预留接口

## 🔧 故障排除

### API连接问题

如果遇到 `401 status code` 错误：

1. **检查API密钥**：确保 `.env.local` 中的 `SILICONFLOW_API_KEY` 是有效的
2. **重新获取密钥**：登录硅基流动官网获取新的API密钥
3. **重启服务器**：修改环境变量后需要重启 `npm run dev`
4. **运行测试**：使用 `node test-api.js` 验证连接

### 模拟数据模式

当API密钥无效时，系统会自动降级使用本地模拟数据：
- 情绪分析基于关键词匹配
- AI回复使用预设模板
- 功能正常但无法获得真实AI回复

### 常见错误

- `Error: API请求失败: 401` - API密钥无效
- `未找到 SILICONFLOW_API_KEY` - 环境变量未配置
- `API响应格式错误` - 网络连接问题

## 🌐 部署

### Vercel部署 (推荐)

1. 连接GitHub仓库到Vercel
2. 配置环境变量
3. 自动部署

### 手动部署

```bash
npm run build
npm start
```

## 📝 更新日志

### v0.1.1 - UI重大升级 (当前)
- ✅ 智能情绪分析
- ✅ 情绪驱动对话
- ✅ 智能任务拆解
- ✅ 🎨 全新现代化聊天界面
- ✅ 📝 完整Markdown渲染支持
- ✅ 💻 代码语法高亮
- ✅ 🌓 深色/浅色主题切换
- ✅ 🚀 流畅动画和交互体验
- ✅ 完整测试覆盖

### v0.1.0 - MVP发布
- ✅ 基础聊天功能
- ✅ 情绪分析核心
- ✅ 任务拆解逻辑

### v0.2.0 - 计划中
- 🔄 番茄钟功能
- 🔄 任务进度管理
- 🔄 数据可视化

## 🤝 贡献指南

1. Fork 本仓库
2. 创建功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add amazing feature'`)
4. 推送分支 (`git push origin feature/amazing-feature`)
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 🔗 相关链接

- [硅基流动API文档](https://docs.siliconflow.cn)
- [Next.js文档](https://nextjs.org/docs)
- [Tailwind CSS文档](https://tailwindcss.com/docs)
- [shadcn/ui组件库](https://ui.shadcn.com)

---

💡 **提示**: 这是MVP版本，专注于核心功能验证。更多高级功能正在开发中！ 